(()=>{"use strict";var e=document.querySelector(".profile__avatar-edit-button"),t=document.querySelector(".profile__edit-button"),n=document.querySelector(".profile__add-button"),o=document.querySelector(".popup_type_deleteConfirm"),r=document.querySelector(".popup_type_avatarEdit"),c=document.querySelector(".popup_type_profileEdit"),a=(c.querySelector(".popup__toggle"),document.forms.avatarEditForm),u=document.forms.profileEditForm,i=document.forms.elementAddForm,l=document.forms.deleteConfirmForm,s=document.querySelectorAll(".popup"),d=document.querySelector(".popup_type_elementAdd"),m=(d.querySelector(".popup__toggle"),document.querySelector(".popup_type_imagePreview")),f=(m.querySelector(".popup__toggle"),document.querySelector(".elements")),p=a.avatarSrc,_=u.userName,v=u.aboutYourself,y=document.querySelector(".profile__title"),h=document.querySelector(".profile__subtitle"),S=document.querySelector(".profile__avatar");function b(e){"Escape"===e.key&&q(document.querySelector(".popup_opened"))}function g(e){document.addEventListener("keydown",b),e.classList.add("popup_opened")}function q(e){document.removeEventListener("keydown",b),e.classList.remove("popup_opened")}function E(e){o.id=e.target.closest(".element").id,g(o)}function k(e,t,n){var o=t.querySelector(".form__button"),r=o.textContent;return o.textContent=e?"Сохранение...":n,r}var L={baseUrl:"https://nomoreparties.co/v1/plus-cohort-9",headers:{authorization:"15079f84-7c32-450a-9816-73a1a409c0ce","Content-Type":"application/json"}};function C(e){var t=document.querySelector("#element-template").content.querySelector(".element").cloneNode(!0);return e||t.querySelector(".element__delete-button").remove(),t}function j(e,t,n,o,r,c){return e.querySelector(".element__title").textContent=n,e.id=o,function(e,t){return t.some((function(t){return t._id===e}))}(c,r)?e.querySelector(".element__like-button").classList.add("like-button_active"):e.querySelector(".element__like-button").classList.remove("like-button_active"),e.querySelector(".element__likes-count").textContent=r.length,function(e,t,n){var o=e.querySelector(".element__image");o.src=t,o.alt=n,o.addEventListener("click",(function(){var e=m.querySelector(".popup__image"),o=m.querySelector(".popup__image-heading");e.src=t,e.alt=n,o.textContent=n,g(m)})),e.querySelector(".element__like-button").addEventListener("click",(function(e){e.target.classList.toggle("like-button_active");var t=e.target.classList.contains("like-button_active")?"PUT":"DELETE";(function(e,t){return fetch("".concat(L.baseUrl,"/cards/likes/").concat(e),{method:t,headers:L.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))})(e.target.closest(".element").id,t).then((function(t){e.target.closest(".element").querySelector(".element__likes-count").textContent=t.likes.length})).catch((function(e){console.log(e)}))}));var r=e.querySelector(".element__delete-button");r&&r.addEventListener("click",E)}(e,t,n),e}function x(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.classList.remove(n.inactiveButtonClass),t.disabled=!1):(t.classList.add(n.inactiveButtonClass),t.disabled=!0)}var P,A="";function U(e,t){t.prepend(e)}e.addEventListener("click",(function(){p.value=S.src,g(r)})),t.addEventListener("click",(function(){_.value=y.textContent,v.value=h.textContent,g(c)})),n.addEventListener("click",(function(){g(d)})),s.forEach((function(e){e.addEventListener("mousedown",(function(t){(t.target.classList.contains("popup_opened")||t.target.classList.contains("popup__toggle"))&&q(e)}))})),a.addEventListener("submit",(function(e){e.preventDefault();var t,n=k(!0,a,"");(t={avatar:p.value},fetch("".concat(L.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:L.headers,body:JSON.stringify(t)}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).then((function(e){S.src=e.avatar,q(r)})).catch((function(e){console.log(e)})).finally((function(){k(!1,a,n)}))})),u.addEventListener("submit",(function(e){e.preventDefault();var t,n=k(!0,u,"");(t={name:_.value,about:v.value},fetch("".concat(L.baseUrl,"/users/me"),{method:"PATCH",headers:L.headers,body:JSON.stringify(t)}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).then((function(e){y.textContent=e.name,h.textContent=e.about,q(c)})).catch((function(e){console.log(e)})).finally((function(){k(!1,u,n)}))})),i.addEventListener("submit",(function(e){e.preventDefault();var t,n=k(!0,i,"");(t={name:i.elementName.value,link:i.elementSrc.value},fetch("".concat(L.baseUrl,"/cards"),{method:"POST",headers:L.headers,body:JSON.stringify(t)}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).then((function(e){U(j(C(!0),e.link,e.name,e._id,[],A),f),i.elementSrc.value="",i.elementName.value="",x(Array.from(i.querySelectorAll(".form__item")),i.querySelector(".form__button"),{inactiveButtonClass:"form__button_disabled"}),q(d)})).catch((function(e){console.log(e)})).finally((function(){k(!1,i,n)}))})),l.addEventListener("submit",(function(e){var t=e.target.closest(".popup").id;e.target.closest(".popup").id="";var n,r=k(!0,l,"");(n=t,fetch("".concat(L.baseUrl,"/cards/").concat(n),{method:"DELETE",headers:L.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).then((function(e){document.getElementById(t).remove(),q(o)})).catch((function(e){console.log(e)})).finally((function(){k(!1,l,r)}))})),fetch("".concat(L.baseUrl,"/users/me"),{headers:L.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){y.textContent=e.name,h.textContent=e.about,S.src=e.avatar,A=e._id})).catch((function(e){console.log(e)})),fetch("".concat(L.baseUrl,"/cards"),{headers:L.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){e.forEach((function(e){U(j(C(e.owner._id===A),e.link,e.name,e._id,e.likes,A),f)}))})).catch((function(e){console.log(e)})),P={formSelector:".popup__form",inputSelector:".form__item",submitButtonSelector:".form__button",inactiveButtonClass:"form__button_disabled",inputErrorClass:"form__item_type_error",errorClass:"form__error_visible"},Array.from(document.querySelectorAll(P.formSelector)).forEach((function(e){e.addEventListener("submit",(function(e){e.preventDefault()})),function(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.submitButtonSelector);x(n,o,t),n.forEach((function(r){r.addEventListener("input",(function(){!function(e,t,n){t.validity.valid?function(e,t,n){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(n.inputErrorClass),o.classList.remove(n.errorClass),o.textContent=""}(e,t,n):function(e,t,n,o){var r=e.querySelector(".".concat(t.id,"-error"));t.classList.add(o.inputErrorClass),r.classList.add(o.errorClass),r.textContent=n}(e,t,t.validationMessage,n)}(e,r,t),x(n,o,t)}))}))}(e,P)}))})();