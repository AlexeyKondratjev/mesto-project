(()=>{"use strict";var e=document.querySelector(".profile__avatar-edit-button"),t=document.querySelector(".profile__edit-button"),n=document.querySelector(".profile__add-button"),o=document.querySelector(".popup_type_deleteConfirm"),r=document.querySelector(".popup_type_avatarEdit"),c=document.querySelector(".popup_type_profileEdit"),a=(c.querySelector(".popup__toggle"),document.forms.avatarEditForm),u=document.forms.profileEditForm,i=document.forms.elementAddForm,l=document.forms.deleteConfirmForm,s=document.querySelectorAll(".popup"),d=document.querySelector(".popup_type_elementAdd"),m=(d.querySelector(".popup__toggle"),document.querySelector(".popup_type_imagePreview")),f=(m.querySelector(".popup__toggle"),document.querySelector(".elements")),_=a.avatarSrc,p=u.userName,v=u.aboutYourself,y=document.querySelector(".profile__title"),h=document.querySelector(".profile__subtitle"),S=document.querySelector(".profile__avatar");function b(e,t,n){var o=t.querySelector(".form__button"),r=o.textContent;return o.textContent=e?"Сохранение...":n,r}function q(e){"Escape"===e.key&&E(document.querySelector(".popup_opened"))}function g(e){document.addEventListener("keydown",q),e.classList.add("popup_opened")}function E(e){document.removeEventListener("keydown",q),e.classList.remove("popup_opened")}s.forEach((function(e){e.addEventListener("mousedown",(function(t){(t.target.classList.contains("popup_opened")||t.target.classList.contains("popup__toggle"))&&E(e)}))}));var k={baseUrl:"https://nomoreparties.co/v1/plus-cohort-9",headers:{authorization:"15079f84-7c32-450a-9816-73a1a409c0ce","Content-Type":"application/json"}},L="";function C(){return document.querySelector("#element-template").content.querySelector(".element").cloneNode(!0)}function j(e,t,n,r,c,a,u){return e.querySelector(".element__title").textContent=n,e.id=r,function(e,t){return t.some((function(t){return t._id===e}))}(a,c)?e.querySelector(".element__like-button").classList.add("like-button_active"):e.querySelector(".element__like-button").classList.remove("like-button_active"),e.querySelector(".element__likes-count").textContent=c.length,a!==u&&e.querySelector(".element__delete-button").remove(),function(e,t,n){var r=e.querySelector(".element__image");r.src=t,r.alt=n,r.addEventListener("click",(function(){var e=m.querySelector(".popup__image"),o=m.querySelector(".popup__image-heading");e.src=t,e.alt=n,o.textContent=n,g(m)})),e.querySelector(".element__like-button").addEventListener("click",(function(e){e.target.classList.toggle("like-button_active");var t=e.target.classList.contains("like-button_active")?"PUT":"DELETE";(function(e,t){return fetch("".concat(k.baseUrl,"/cards/likes/").concat(e),{method:t,headers:k.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))})(e.target.closest(".element").id,t).then((function(t){e.target.closest(".element").querySelector(".element__likes-count").textContent=t.likes.length})).catch((function(e){console.log(e)}))}));var c=e.querySelector(".element__delete-button");c&&c.addEventListener("click",(function(e){L=e.target.closest(".element").id,g(o)}))}(e,t,n),e}function x(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.classList.remove(n.inactiveButtonClass),t.disabled=!1):(t.classList.add(n.inactiveButtonClass),t.disabled=!0)}var P,A="";function U(e,t){t.prepend(e)}e.addEventListener("click",(function(){_.value=S.src,g(r)})),t.addEventListener("click",(function(){p.value=y.textContent,v.value=h.textContent,g(c)})),n.addEventListener("click",(function(){g(d)})),a.addEventListener("submit",(function(e){e.preventDefault();var t,n=b(!0,a,"");(t={avatar:_.value},fetch("".concat(k.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:k.headers,body:JSON.stringify(t)}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).then((function(e){S.src=e.avatar,E(r)})).catch((function(e){console.log(e)})).finally((function(){b(!1,a,n)}))})),u.addEventListener("submit",(function(e){e.preventDefault();var t,n=b(!0,u,"");(t={name:p.value,about:v.value},fetch("".concat(k.baseUrl,"/users/me"),{method:"PATCH",headers:k.headers,body:JSON.stringify(t)}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).then((function(e){y.textContent=e.name,h.textContent=e.about,E(c)})).catch((function(e){console.log(e)})).finally((function(){b(!1,u,n)}))})),i.addEventListener("submit",(function(e){e.preventDefault();var t,n=b(!0,i,"");(t={name:i.elementName.value,link:i.elementSrc.value},fetch("".concat(k.baseUrl,"/cards"),{method:"POST",headers:k.headers,body:JSON.stringify(t)}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).then((function(e){U(j(C(),e.link,e.name,e._id,[],A,e.owner._id),f),i.reset(),x(Array.from(i.querySelectorAll(".form__item")),i.querySelector(".form__button"),{inactiveButtonClass:"form__button_disabled"}),E(d)})).catch((function(e){console.log(e)})).finally((function(){b(!1,i,n)}))})),l.addEventListener("submit",(function(){var e,t=b(!0,l,"");(e=L,fetch("".concat(k.baseUrl,"/cards/").concat(e),{method:"DELETE",headers:k.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).then((function(e){document.getElementById(L).remove(),E(o)})).catch((function(e){console.log(e)})).finally((function(){b(!1,l,t)}))})),Promise.all([fetch("".concat(k.baseUrl,"/users/me"),{headers:k.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})),fetch("".concat(k.baseUrl,"/cards"),{headers:k.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))]).then((function(e){var t=e[0],n=e[1];y.textContent=t.name,h.textContent=t.about,S.src=t.avatar,A=t._id,n.forEach((function(e){U(j(C(),e.link,e.name,e._id,e.likes,A,e.owner._id),f)}))})).catch((function(e){console.log(e)})),P={formSelector:".popup__form",inputSelector:".form__item",submitButtonSelector:".form__button",inactiveButtonClass:"form__button_disabled",inputErrorClass:"form__item_type_error",errorClass:"form__error_visible"},Array.from(document.querySelectorAll(P.formSelector)).forEach((function(e){e.addEventListener("submit",(function(e){e.preventDefault()})),function(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.submitButtonSelector);x(n,o,t),n.forEach((function(r){r.addEventListener("input",(function(){!function(e,t,n){t.validity.valid?function(e,t,n){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(n.inputErrorClass),o.classList.remove(n.errorClass),o.textContent=""}(e,t,n):function(e,t,n,o){var r=e.querySelector(".".concat(t.id,"-error"));t.classList.add(o.inputErrorClass),r.classList.add(o.errorClass),r.textContent=n}(e,t,t.validationMessage,n)}(e,r,t),x(n,o,t)}))}))}(e,P)}))})();