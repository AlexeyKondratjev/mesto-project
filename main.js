(()=>{"use strict";var e=document.querySelector(".profile__avatar-edit-button"),t=document.querySelector(".profile__edit-button"),n=document.querySelector(".profile__add-button"),o=document.querySelector(".popup_type_avatarEdit"),r=document.querySelector(".popup_type_profileEdit"),c=(r.querySelector(".popup__toggle"),document.forms.avatarEditForm),a=document.forms.profileEditForm,u=document.querySelectorAll(".popup"),i=document.querySelector(".popup_type_elementAdd"),l=(i.querySelector(".popup__toggle"),document.forms.elementAddForm),s=document.querySelector(".popup_type_imagePreview"),d=(s.querySelector(".popup__toggle"),document.querySelector(".elements")),m=c.avatarSrc,f=a.userName,_=a.aboutYourself,p=document.querySelector(".profile__title"),v=document.querySelector(".profile__subtitle"),y=document.querySelector(".profile__avatar");function h(e){"Escape"===e.key&&b(document.querySelector(".popup_opened"))}function S(e){document.addEventListener("keydown",h),e.classList.add("popup_opened")}function b(e){document.removeEventListener("keydown",h),e.classList.remove("popup_opened")}function q(e,t,n){var o=t.querySelector(".form__button"),r=o.textContent;return o.textContent=e?"Сохранение...":n,r}var g={baseUrl:"https://nomoreparties.co/v1/plus-cohort-9",headers:{authorization:"15079f84-7c32-450a-9816-73a1a409c0ce","Content-Type":"application/json"}};function E(e){var t=document.querySelector("#element-template").content.querySelector(".element").cloneNode(!0);return e||t.querySelector(".element__delete-button").remove(),t}function k(e,t,n,o,r,c){return e.querySelector(".element__title").textContent=n,e.id=o,function(e,t){return t.some((function(t){return t._id===e}))}(c,r)?e.querySelector(".element__like-button").classList.add("like-button_active"):e.querySelector(".element__like-button").classList.remove("like-button_active"),e.querySelector(".element__likes-count").textContent=r.length,function(e,t,n){var o=e.querySelector(".element__image");o.src=t,o.alt=n,o.addEventListener("click",(function(){var e=s.querySelector(".popup__image"),o=s.querySelector(".popup__image-heading");e.src=t,e.alt=n,o.textContent=n,S(s)})),e.querySelector(".element__like-button").addEventListener("click",(function(e){e.target.classList.toggle("like-button_active");var t=e.target.classList.contains("like-button_active")?"PUT":"DELETE";(function(e,t){return fetch("".concat(g.baseUrl,"/cards/likes/").concat(e),{method:t,headers:g.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))})(e.target.closest(".element").id,t).then((function(t){e.target.closest(".element").querySelector(".element__likes-count").textContent=t.likes.length})).catch((function(e){console.log(e)}))}));var r=e.querySelector(".element__delete-button");r&&r.addEventListener("click",(function(e){var t,n=e.target.closest(".element");(t=n.id,fetch("".concat(g.baseUrl,"/cards/").concat(t),{method:"DELETE",headers:g.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).then((function(e){n.remove()})).catch((function(e){console.log(e)}))}))}(e,t,n),e}function L(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.classList.remove(n.inactiveButtonClass),t.disabled=!1):(t.classList.add(n.inactiveButtonClass),t.disabled=!0)}var C,j="";function x(e,t){t.prepend(e)}e.addEventListener("click",(function(){m.value=y.src,S(o)})),t.addEventListener("click",(function(){f.value=p.textContent,_.value=v.textContent,S(r)})),n.addEventListener("click",(function(){S(i)})),u.forEach((function(e){e.addEventListener("mousedown",(function(t){(t.target.classList.contains("popup_opened")||t.target.classList.contains("popup__toggle"))&&b(e)}))})),c.addEventListener("submit",(function(e){e.preventDefault();var t,n=q(!0,c,"");(t={avatar:m.value},fetch("".concat(g.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:g.headers,body:JSON.stringify(t)}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).then((function(e){y.src=e.avatar,b(o)})).catch((function(e){console.log(e)})).finally((function(){q(!1,c,n)}))})),a.addEventListener("submit",(function(e){e.preventDefault();var t,n=q(!0,a,"");(t={name:f.value,about:_.value},fetch("".concat(g.baseUrl,"/users/me"),{method:"PATCH",headers:g.headers,body:JSON.stringify(t)}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).then((function(e){p.textContent=e.name,v.textContent=e.about,b(r)})).catch((function(e){console.log(e)})).finally((function(){q(!1,a,n)}))})),l.addEventListener("submit",(function(e){e.preventDefault();var t,n=q(!0,l,"");(t={name:l.elementName.value,link:l.elementSrc.value},fetch("".concat(g.baseUrl,"/cards"),{method:"POST",headers:g.headers,body:JSON.stringify(t)}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).then((function(e){x(k(E(!0),e.link,e.name,e._id,[],j),d),l.elementSrc.value="",l.elementName.value="",L(Array.from(l.querySelectorAll(".form__item")),l.querySelector(".form__button"),{inactiveButtonClass:"form__button_disabled"}),b(i)})).catch((function(e){console.log(e)})).finally((function(){q(!1,l,n)}))})),fetch("".concat(g.baseUrl,"/users/me"),{headers:g.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){p.textContent=e.name,v.textContent=e.about,y.src=e.avatar,j=e._id})).catch((function(e){console.log(e)})),fetch("".concat(g.baseUrl,"/cards"),{headers:g.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){e.forEach((function(e){x(k(E(e.owner._id===j),e.link,e.name,e._id,e.likes,j),d)}))})).catch((function(e){console.log(e)})),C={formSelector:".popup__form",inputSelector:".form__item",submitButtonSelector:".form__button",inactiveButtonClass:"form__button_disabled",inputErrorClass:"form__item_type_error",errorClass:"form__error_visible"},Array.from(document.querySelectorAll(C.formSelector)).forEach((function(e){e.addEventListener("submit",(function(e){e.preventDefault()})),function(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.submitButtonSelector);L(n,o,t),n.forEach((function(r){r.addEventListener("input",(function(){!function(e,t,n){t.validity.valid?function(e,t,n){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(n.inputErrorClass),o.classList.remove(n.errorClass),o.textContent=""}(e,t,n):function(e,t,n,o){var r=e.querySelector(".".concat(t.id,"-error"));t.classList.add(o.inputErrorClass),r.classList.add(o.errorClass),r.textContent=n}(e,t,t.validationMessage,n)}(e,r,t),L(n,o,t)}))}))}(e,C)}))})();